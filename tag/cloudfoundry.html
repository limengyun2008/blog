<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8">
        <title>limengyun's blog - cloudfoundry</title>
        <link rel="stylesheet" href="../theme/css/main.css">
                <link href="http://limengyun.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="limengyun's blog Atom Feed" />
                
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">limengyun's blog </a></h1>
                <nav><ul>
                                                                                    <li ><a href="../category/backend.html">backend</a></li>
                                    <li ><a href="../category/misc.html">misc</a></li>
                                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../cloudfoundry/index.html">cloudfoundry 2.0 on CentOS 6 小结</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2013-06-17T10:00:00">
                Mon 17 June 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info --><h2>安装</h2>
<p>这不是官方安装说明的中文版：这里讲的是使用<strong>各个组件的源代码</strong>在<strong>centOS 6</strong>上搭建cloudfoundry 2.0，网上没发现有人这么干的。之所以这么做，原因见下：</p>
<p>cloudfoundry 的许多源代码都基于于ubuntu 发行版带有的文件系统和命令之上，
且对于最新的2.0，官方仅给出了一种基于Iaas的部署方式，大批量的创建ubuntu 虚拟机，然后使用cloudfoundry的发行包批量部署cloudfoundry。</p>
<p>这个需要有openstack，Vsphere 等底层IaaS作为支持，如果没有但又想继续使用cloudfoundry，只有三种方案：</p>
<ol>
<li>使用cloudfoundry 1.0 <a href="https://github.com/cloudfoundry/vcap">vcap</a>, 1.0提供了一个脚本来将所有组件安装到一台机器上，笔者曾经成功将1.0适配到centOS上。</li>
<li>先搭一个openstack，用熟了再基于官方提供的部署方式进行安装</li>
<li>自己鼓捣源码，在centOS上自己装</li>
</ol>
<p>方案1意味着以后都得不到官方的任何改进，方案2不属于自己的工作范围，等于是一个研发去弄运维的事情。权衡利弊之后选择了方案3，但是在这个过程中同样遇到了很多centOS上特有的问题。</p>
<p>在解决问题的过程中，我们记录了一些文档，放在github上： <a href="https://github.com/youdao-cf/docs/tree/master/install">链接</a> 上，简单描述如何在centos上安装cloudfoundry并进行配置。
有些做法的理由会在组件细节中说明</p>
<p>总体来说，如果是ubuntu系统（最好是10.04）基本所有组件安装后经过合理的配置，都可以正常运行。</p>
<p>但如果是其他linux发行版，除了配置问题，还会碰到各种因为操作系统引起的bug，有一些需要修改源代码，所有修改的源码地址都在安装文档中给出，在组件细节中也会提出修改的思路。</p>
<h2>cloudfoundry 组件简介</h2>
<p>Cloudfoudnry 1.0已于在2013年1月底停止开发与维护。现在网上许多cloudfoundry的文章将的都是跟1.0有关的内容，在此指出一些主要的区别。</p>
<ul>
<li>1.0中router使用的是nginx+lua+ruby server的方式，2.0使用了go语言gorouter，据称支持了websocket且极大提升了性能。</li>
<li>2.0中cloud contoller新增了quota，org，space等新的概念，更方便的进行权限和资源管理。</li>
<li>1.0中为应用打包使用的是stager组件，2.0中移除了该组件，将打包功能加入到dea中，并将所有语言的打包程序以submodule的形式放在buildpacks/vendors 目录下。</li>
<li>完全重写了health manager</li>
<li>1.0里 dea可以独立运行，一个dea负责的所有app都以子进程的形式挂在dea主进程下。但2.0之后dea强依赖于warden提供的安全容器来运行app了</li>
</ul>
<p>下面是cloudfoundry 2.0的架构示意图，</p>
<p><img src="http://docs.cloudfoundry.com/images/cf_architecture.png" style="width:785px;" alt="cloudfoundry 架构图" /></p>
<h4>NATS</h4>
<p>CloudFoundry是一个多模块的分布式系统，支持模块自发现，错误自检，且模块间低耦合。其核心原理就是基于消息发布订阅机制。</p>
<p>而NATS则是支持这个机制的最关键的消息系统，它是cloudfoundry中最核心的组件。</p>
<p><a href="/cloudfoundry/nats.html">nats链接组件的两个例子</a></p>
<h4>Router</h4>
<p>负责处理分发所有的请求到相对应的模块，包括来自外部用户对app的请求和平台内部控制请求。</p>
<p>已经在NATS中讲过了，不再赘述。</p>
<p>值得一提的是2.0用了go重写了1.0用nginx+lua嵌入脚本的router 号称比1.0有4X的性能提升，貌似go确实挺牛逼的。</p>
<h4>Warden</h4>
<p>warden 在操作系统上层提供轻量级的运行应用的虚拟容器，为平台提供安全支持。</p>
<p><a href="/cloudfoundry/warden.html">warden及平台安全</a></p>
<h4>DEA</h4>
<p>接收来自cloud controller的指令，根据指令使用warden提供的虚拟容器对应用进行打包，运行等关键操作。</p>
<p><a href="/cloudfoundry/dea.html">dea和buildpack</a></p>
<h4>Cloud Controller</h4>
<p>Cloud Controller是CloudFoundry的管理模块。对外提供平台全部的api</p>
<p><a href="/cloudfoundry/cloudcontroller.html">Cloud Controller</a></p>
<h4>UAA</h4>
<p>全称是User Account and Authentication，负责用户账户和验证</p>
<p><a href="/cloudfoundry/uaa.html">UAA</a></p>
<h4>Health Manager</h4>
<p>负责检查各个组件的状态</p>
<p><a href="/cloudfoundry/hm.html">Health Manager</a></p>
<h4>其他组件</h4>
<ul>
<li>Services: cloudfoundry为应用提供的各类服务，如mysql，memcached，由于时间原因，我暂时没有支持。</li>
<li>Syslog Aggregator：归集log的组件，非必要，也没有支持</li>
<li>Collector： 监听nats中的各类消息来监控各组件的运行状态，非必要，也没有支持。</li>
</ul>
<h4>自行开发的组件</h4>
<ul>
<li>console： cloudfoundry的web界面，自行开发的，详情：<a href="/cloudfoundry/console.html">console</a></li>
</ul>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/dea.html" rel="bookmark"
                           title="Permalink to DEA 和 buildpack">DEA 和 buildpack</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-06-13T10:00:00">
                Thu 13 June 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                
                <a class="readmore" href="../cloudfoundry/dea.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/hm.html" rel="bookmark"
                           title="Permalink to Health Manager">Health Manager</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-06-13T10:00:00">
                Thu 13 June 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                
                <a class="readmore" href="../cloudfoundry/hm.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/uaa.html" rel="bookmark"
                           title="Permalink to UAA">UAA</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-06-13T10:00:00">
                Thu 13 June 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                
                <a class="readmore" href="../cloudfoundry/uaa.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/warden.html" rel="bookmark"
                           title="Permalink to warden及平台安全">warden及平台安全</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-06-13T00:00:00">
                Thu 13 June 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                
                <a class="readmore" href="../cloudfoundry/warden.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/cloudcontroller.html" rel="bookmark"
                           title="Permalink to Cloud Controller">Cloud Controller</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-05-29T10:20:00">
                Wed 29 May 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                <p>介绍Cloud Controller</p>
                <a class="readmore" href="../cloudfoundry/cloudcontroller.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/console.html" rel="bookmark"
                           title="Permalink to Console">Console</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-05-29T10:20:00">
                Wed 29 May 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                
                <a class="readmore" href="../cloudfoundry/console.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../cloudfoundry/nats.html" rel="bookmark"
                           title="Permalink to NATS">NATS</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-05-29T10:20:00">
                Wed 29 May 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/limengyun.html">limengyun</a>
        </address>
        <p>In <a href="../category/backend.html">backend</a>. </p>
<p>tags: <a href="../tag/cloudfoundry.html">cloudfoundry</a></p>
</footer><!-- /.post-info -->                <p>an article for cloudfoundry architecture</p>
                <a class="readmore" href="../cloudfoundry/nats.html">read more</a>
                                </div><!-- /.entry-content -->
			<div style="clear:both"></div>
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://getpelican.com/">Pelican</a></li>
                                                    <li><a href="http://python.org/">Python.org</a></li>
                                                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                                                    <li><a href="/pages/markdown-syntax.html">Markdown Syntax</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>友情链接</h2>
                        <ul>
                            <li><a href="http://limengyun.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://huihui.cn/?keyfrom=limengyun.com">网易惠惠</a></li>
                                                    <li><a href="http://www.xiaoshuov.com">xiaoshuov</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>&copy; copyright 2013. <a href="http://limengyun.com">limengyun.com</a>, thanks for visiting!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37781337-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>